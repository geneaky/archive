마이크로 서비스 왜 하는지에 대한 정의?
마이크로 서비스에 대한 기준이 애매함

db 분리에 대한 고민 거리
api 속도
트랜잭션 보장 문제 따른 정합성 문제 --> 공유락, 분산 라 

api 속도에 대한 문제 대답
화면 구성에 필요한 데이터를 분리해서 각각의 서비스에 요청을 보내면 괜찮음

api 응답에 필요한 데이터가 테이블이 분리된 경우 하나의 query에 대한 응답으로 각각의 마이크로 서비스에 api를 호출해야하기 때문에 그에 따라서는 응답이 느려질 수 있는것은 맞음

1. 자주 조회하며, 변경이 잦은 데이터는 별로 없음
2. 변경이 낮으면서 조회 빈도가 잦은 데이터는 최적화가 가능함

2번같은 경우 데이터 복제를 고려해볼 수 있음
단 데이터 복제시 사용하는 속성만 사용하기 좋은 형태로 복제 해야한다
마이크로 서비스를 설명할때 데이터 복제에 대해 지양한다는 언급은 없음.

모델링 변경을 고려해볼 수 있음
공통된 속성은 복제해서 각각의 서비스가 가지고 있도록하고 각 서비스에 필요한 데이터만 분리된 데이터베이스에서 갖도록 한다.

일괄조회를 고려해볼 수 있음
하나의 api호출이 마이크로서비스에서는 내부적으로 N+1문제가 발생할 수 있기 때문에
그런 방식보다는 1건에 필요한 데이터를 다른 마이크로 서비스로 호출할때 다 건을 한 번에 응답으로 받을 수 있도록 구현

병렬조회는 순간적으로 큰 부하가 생길 수 있기 때문에 안티패턴이다(ddos랑 같음)
꼭 필요한 경우에만 이로갈 조회를 병렬로 실행 (가끔 있는 경우)

로컬캐시를 고려해볼 수 있음
네트워크 호출을 줄여주기때문에 효율 적임, redis는 네트워크를 태워야하기때문에 느림
로컬 캐시는 동기화 하지 않음 -> 동기화가 필요한 노드가 늘어날수록 느려지기 때문


##### 트랜잭션 보장 없이 정합성이 맞을까에 대한 걱정?
원자성과, 독립성에 대한 부분이 사라지기 때문에 발생한 문제
##### 원자성 보완 방법
롤백시 삭제 api 호출을 함 > 이것도 문제가됨 > 네트워크 fail 상태에 데이터 처리를 못함
이 경우 데이터 정합성이 안맞는 데이터를 맞추기위해 대사 작업을 해야함;
api 재시도를 걸 수는 있음 > 하지만 이것도 완전성을 보장하지 못함, 처리하는 측 서버에 장애를 더 크게 만들 수 있어서 
안하는게 좋음

그래서 이벤트로 재시도해야함 -> 이벤트는 무조건 전달됨, 실패해도 결국 전달됨
이벤트를 처리할때는 2번 보내더라도 같은 결과가 나오도록 , 최종적으로 1건 처리와 동일한 상태가 되도록 처리해야한다
데이터가 있으면 무시하거나, 있는 경우 덮어 쓰거나

긴 트랙잭션을 나누기
실패해도 전체 취소가 없다면 나누기 

역할 분리 -> 각 서비스가 알아서

모델링 변경
데이터는 오너십을 가진 서비스에 배치
예시 > 고객 상담 중 생성된 고객의 데이터는 고객 서비스 가 아니라 상담 서비스에 포함되어야한다 상담 서비스가 해당 고객에게 필요한 상덤 데이터를 상담서비스가 가질 것 이기때문

서비스 경계 변경
너무 구현이 힘들다면 서비스를 합치거나 경게를 변경하는 선택지도 있다.

##### 독립성보완방법
트랜잭션 독립성이 보완되지 않기 때문에 각 서비스에서 조회한 데이터가 순간적으로 일치하지 않는 경우가 있음
그래서 기준 시각을 가지고 조회를 하던가 하는 방식으로 처리해야하는데 이렇게 처리해야하는 상황이 많이 않음

데이터베이스의 동기화 메커니즘을 사용할 수 없기 때문에
원래 db가 해주지 않고 개발자가 해결해야하는 문제로 application layer에서 lock을 사용해 해결한다

##### 패턴
꼭 필요한 속성만 복사
일괄 조회
로컬 캐시
전체 취소 안하면 이벤트로 쓰기 
멱등성
분산 모델
데이터는 오너십 가진 서비스에

##### 안티패턴
테이블 스키마 복사
병렬 호출
api 재시도
로컬 캐시 동기화


마이크로 서비스간 api 통신시 응답에 떨어지는 body 사이즈가 큰 경우 파일로 생성하여 파일 다운로드로 전환하여 배치처리하는 것도 고민해볼법함

이벤트를 담당하는 미들웨어가 죽은 경우에 대한 처리방식?